//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by the NetEscapades.EnumGenerators source generator
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

#nullable enable

namespace Something.Blah
{
    /// <summary>
    /// Converts a <see cref="global::Something.Blah.ShortName" /> to or from JSON.
    /// </summary>
    public sealed class ShortNameConverter : global::System.Text.Json.Serialization.JsonConverter<global::Something.Blah.ShortName>
    {
        private const string PropertyName = "shortName";

        /// <inheritdoc />
        /// <summary>
        /// Read and convert the JSON to <see cref="global::Something.Blah.ShortName" />.
        /// </summary>
        /// <remarks>
        /// A converter may throw any Exception, but should throw <see cref="global::System.Text.Json.JsonException" /> when the JSON is invalid.
        /// </remarks>
        public override global::Something.Blah.ShortName Read(ref global::System.Text.Json.Utf8JsonReader reader, global::System.Type typeToConvert, global::System.Text.Json.JsonSerializerOptions options)
        {
#if NETCOREAPP && !NETCOREAPP2_0 && !NETCOREAPP1_1 && !NETCOREAPP1_0
            char[]? rentedBuffer = null;
            var bufferLength = reader.HasValueSequence ? checked((int)reader.ValueSequence.Length) : reader.ValueSpan.Length;

            var charBuffer = bufferLength <= 128
                ? stackalloc char[128]
                : rentedBuffer = global::System.Buffers.ArrayPool<char>.Shared.Rent(bufferLength);

            var charsWritten = reader.CopyString(charBuffer);
            global::System.ReadOnlySpan<char> source = charBuffer[..charsWritten];
            try
            {
                if (global::Something.Blah.ShortNameExtensions.TryParse(source, out var enumValue, true, true))
                    return enumValue;

                throw new global::System.Text.Json.JsonException($"{source.ToString()} is not a valid value.", PropertyName, null, null);
            }
            finally
            {
                if (rentedBuffer is not null)
                {
                    charBuffer[..charsWritten].Clear();
                    global::System.Buffers.ArrayPool<char>.Shared.Return(rentedBuffer);
                }
            }
#else
            var source = reader.GetString();
            if (global::Something.Blah.ShortNameExtensions.TryParse(source, out var enumValue, true, true))
                return enumValue;

            throw new global::System.Text.Json.JsonException($"{source} is not a valid value.", PropertyName, null, null);
#endif
        }

        /// <inheritdoc />
        public override void Write(global::System.Text.Json.Utf8JsonWriter writer, global::Something.Blah.ShortName value, global::System.Text.Json.JsonSerializerOptions options)
            => writer.WriteStringValue(global::Something.Blah.ShortNameExtensions.ToStringFast(value));
    }
}
